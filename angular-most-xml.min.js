function XmlCommon(){this.DOM_ELEMENT_NODE=1,this.DOM_ATTRIBUTE_NODE=2,this.DOM_TEXT_NODE=3,this.DOM_CDATA_SECTION_NODE=4,this.DOM_ENTITY_REFERENCE_NODE=5,this.DOM_ENTITY_NODE=6,this.DOM_PROCESSING_INSTRUCTION_NODE=7,this.DOM_COMMENT_NODE=8,this.DOM_DOCUMENT_NODE=9,this.DOM_DOCUMENT_TYPE_NODE=10,this.DOM_DOCUMENT_FRAGMENT_NODE=11,this.DOM_NOTATION_NODE=12,this.REGEXP_UNICODE=function(){for(var e=[" ","Ġ",-1,"!","Ġ",-1,"Ġ","Ġ",0,"ġ","Ġ",-1,"ġ","Ġ|ġ",0,"Ģ","Ġ|ġ",-1,"Ġ","[Ġ]",0,"ġ","[Ġ]",-1,"ġ","[Ġġ]",0,"Ģ","[Ġġ]",-1,"ġ","[Ġ-ġ]",0,"Ģ","[Ġ-ġ]",-1],t=0;t<e.length;t+=3)if(e[t].search(new RegExp(e[t+1]))!=e[t+2])return!1;return!0}(),this.XML_S="[ 	\r\n]+",this.XML_EQ="("+this.XML_S+")?=("+this.XML_S+")?",this.XML_CHAR_REF="&#[0-9]+;|&#x[0-9a-fA-F]+;",this.XML10_VERSION_INFO=this.XML_S+"version"+this.XML_EQ+"(\"1\\.0\"|'1\\.0')",this.XML10_BASE_CHAR=this.REGEXP_UNICODE?"A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣":"A-Za-z",this.XML10_IDEOGRAPHIC=this.REGEXP_UNICODE?"一-龥〇〡-〩":"",this.XML10_COMBINING_CHAR=this.REGEXP_UNICODE?"̀-͠ͅ-҃͡-֑҆-֣֡-ֹֻ-ֽֿׁ-ׂًׄ-ْٰۖ-ۜ۝-۟۠-ۤۧ-۪ۨ-ۭँ-ः़ा-ौ्॑-॔ॢ-ॣঁ-ঃ়ািী-ৄে-ৈো-্ৗৢ-ৣਂ਼ਾਿੀ-ੂੇ-ੈੋ-੍ੰ-ੱઁ-ઃ઼ા-ૅે-ૉો-્ଁ-ଃ଼ା-ୃେ-ୈୋ-୍ୖ-ୗஂ-ஃா-ூெ-ைொ-்ௗఁ-ఃా-ౄె-ైొ-్ౕ-ౖಂ-ಃಾ-ೄೆ-ೈೊ-್ೕ-ೖം-ഃാ-ൃെ-ൈൊ-്ൗัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-༹༙༵༷༾༿ཱ-྄྆-ྋྐ-ྕྗྙ-ྭྱ-ྷྐྵ⃐-〪⃜⃡-゙゚〯":"",this.XML10_DIGIT=this.REGEXP_UNICODE?"0-9٠-٩۰-۹०-९০-৯੦-੯૦-૯୦-୯௧-௯౦-౯೦-೯൦-൯๐-๙໐-໙༠-༩":"0-9",this.XML10_EXTENDER=this.REGEXP_UNICODE?"·ːˑ·ـๆໆ々〱-〵ゝ-ゞー-ヾ":"",this.XML10_LETTER=this.XML10_BASE_CHAR+this.XML10_IDEOGRAPHIC,this.XML10_NAME_CHAR=this.XML10_LETTER+this.XML10_DIGIT+"\\._:"+this.XML10_COMBINING_CHAR+this.XML10_EXTENDER+"-",this.XML10_NAME="["+this.XML10_LETTER+"_:]["+this.XML10_NAME_CHAR+"]*",this.XML10_ENTITY_REF="&"+this.XML10_NAME+";",this.XML10_REFERENCE=this.XML10_ENTITY_REF+"|"+this.XML_CHAR_REF,this.XML10_ATT_VALUE='"(([^<&"]|'+this.XML10_REFERENCE+")*)\"|'(([^<&']|"+this.XML10_REFERENCE+")*)'",this.XML10_ATTRIBUTE="("+this.XML10_NAME+")"+this.XML_EQ+"("+this.XML10_ATT_VALUE+")",this.XML11_VERSION_INFO=this.XML_S+"version"+this.XML_EQ+"(\"1\\.1\"|'1\\.1')",this.XML11_NAME_START_CHAR=this.REGEXP_UNICODE?":A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�":":A-Z_a-z",this.XML11_NAME_CHAR=this.XML11_NAME_START_CHAR+(this.REGEXP_UNICODE?"\\.0-9·̀-ͯ‿-⁀-":"\\.0-9-"),this.XML11_NAME="["+this.XML11_NAME_START_CHAR+"]["+this.XML11_NAME_CHAR+"]*",this.XML11_ENTITY_REF="&"+this.XML11_NAME+";",this.XML11_REFERENCE=this.XML11_ENTITY_REF+"|"+this.XML_CHAR_REF,this.XML11_ATT_VALUE='"(([^<&"]|'+this.XML11_REFERENCE+")*)\"|'(([^<&']|"+this.XML11_REFERENCE+")*)'",this.XML11_ATTRIBUTE="("+this.XML11_NAME+")"+this.XML_EQ+"("+this.XML11_ATT_VALUE+")",this.XML_NC_NAME_CHAR=this.XML10_LETTER+this.XML10_DIGIT+"\\._"+this.XML10_COMBINING_CHAR+this.XML10_EXTENDER+"-",this.XML_NC_NAME="["+this.XML10_LETTER+"_]["+this.XML_NC_NAME_CHAR+"]*",this.XML10_TAGNAME_REGEXP=new RegExp("^("+this.XML10_NAME+")"),this.XML10_ATTRIBUTE_REGEXP=new RegExp(this.XML10_ATTRIBUTE,"g"),this.XML11_TAGNAME_REGEXP=new RegExp("^("+this.XML11_NAME+")"),this.XML11_ATTRIBUTE_REGEXP=new RegExp(this.XML11_ATTRIBUTE,"g")}function Set(){this.keys=[]}function removeFromArray(e,t,n){for(var r=0,a=0;a<e.length;++a)(e[a]===t||n&&e[a]==t)&&(e.splice(a--,1),r++);return r}function XmlUtil(){}function copyArray(e,t){if(t)for(var n=e.length,r=t.length-1;r>=0;--r)e[r+n]=t[r]}function copyArrayIgnoringAttributesWithoutValue(e,t){if(t)for(var n=t.length-1;n>=0;--n)t[n].nodeValue&&e.push(t[n])}function reverseInplace(e){for(var t=0;t<e.length/2;++t){var n=e[t],r=e.length-t-1;e[t]=e[r],e[r]=n}}function xpathLog(){}function assert(e){if(!e)throw"Assertion failed"}function xpathParse(e){xpathLog("parse "+e),xpathParseInit();var t=xpathCacheLookup(e);if(t)return xpathLog(" ... cached"),t;if(e.match(/^(\$|@)?\w+$/i)){var n=makeSimpleExpr(e);return xpathParseCache[e]=n,xpathLog(" ... simple"),n}if(e.match(/^\w+(\/\w+)*$/i)){var n=makeSimpleExpr2(e);return xpathParseCache[e]=n,xpathLog(" ... simple 2"),n}for(var r=e,a=[],i=null,o=null,s=!1,l=0,u=0,p=0;!s;){l++,e=e.replace(/^\s*/,""),o=i,i=null;for(var h=null,c="",E=0;E<xpathTokenRules.length;++E){var m=xpathTokenRules[E].re.exec(e);if(u++,m&&m.length>0&&m[0].length>c.length){h=xpathTokenRules[E],c=m[0];break}}for(!h||h!=TOK_DIV&&h!=TOK_MOD&&h!=TOK_AND&&h!=TOK_OR||o&&o.tag!=TOK_AT&&o.tag!=TOK_DSLASH&&o.tag!=TOK_SLASH&&o.tag!=TOK_AXIS&&o.tag!=TOK_DOLLAR||(h=TOK_QNAME),h?(e=e.substr(c.length),xpathLog("token: "+c+" -- "+h.label),i={tag:h,match:c,prec:h.prec?h.prec:0,expr:makeTokenExpr(c)}):(xpathLog("DONE"),s=!0);xpathReduce(a,i);)p++,xpathLog("stack: "+stackToString(a))}if(xpathLog("stack: "+stackToString(a)),1!=a.length)throw"XPath parse error "+r+":\n"+stackToString(a);var m=a[0].expr;return xpathParseCache[r]=m,xpathLog("XPath parse: "+l+" / "+u+" / "+p),m}function xpathCacheLookup(e){return xpathParseCache[e]}function xpathReduce(e,t){var n=null;if(e.length>0){var r=e[e.length-1],a=xpathRules[r.tag.key];if(a)for(var i=0;i<a.length;++i){var o=a[i],s=xpathMatchStack(e,o[1]);if(s.length){n={tag:o[0],rule:o,match:s},n.prec=xpathGrammarPrecedence(n);break}}}var l;if(n&&(!t||n.prec>t.prec||t.tag.left&&n.prec>=t.prec)){for(var i=0;i<n.match.matchlength;++i)e.pop();xpathLog("reduce "+n.tag.label+" "+n.prec+" ahead "+(t?t.tag.label+" "+t.prec+(t.tag.left?" left":""):" none "));var u=xmlUtil.mapExpr(n.match,function(e){return e.expr});xpathLog("going to apply "+n.rule[3].toString()),n.expr=n.rule[3].apply(null,u),e.push(n),l=!0}else t&&(xpathLog("shift "+t.tag.label+" "+t.prec+(t.tag.left?" left":"")+" over "+(n?n.tag.label+" "+n.prec:" none")),e.push(t)),l=!1;return l}function xpathMatchStack(e,t){var n,r,a=e.length,i=t.length,o=[];o.matchlength=0;var s=0;for(n=i-1,r=a-1;n>=0&&r>=0;--n,r-=s){s=0;var l=[];if(t[n]==Q_MM)for(n-=1,o.push(l);r-s>=0&&e[r-s].tag==t[n];)l.push(e[r-s]),s+=1,o.matchlength+=1;else if(t[n]==Q_01)for(n-=1,o.push(l);r-s>=0&&2>s&&e[r-s].tag==t[n];)l.push(e[r-s]),s+=1,o.matchlength+=1;else if(t[n]==Q_1M){if(n-=1,o.push(l),e[r].tag!=t[n])return[];for(;r-s>=0&&e[r-s].tag==t[n];)l.push(e[r-s]),s+=1,o.matchlength+=1}else{if(e[r].tag!=t[n])return[];o.push(e[r]),s+=1,o.matchlength+=1}reverseInplace(l),l.expr=xmlUtil.mapExpr(l,function(e){return e.expr})}return reverseInplace(o),-1==n?o:[]}function xpathTokenPrecedence(e){return e.prec||2}function xpathGrammarPrecedence(e){var t=0;if(e.rule)if(e.rule.length>=3&&e.rule[2]>=0)t=e.rule[2];else for(var n=0;n<e.rule[1].length;++n){var r=xpathTokenPrecedence(e.rule[1][n]);t=Math.max(t,r)}else if(e.tag)t=xpathTokenPrecedence(e.tag);else if(e.length)for(var a=0;a<e.length;++a){var r=xpathGrammarPrecedence(e[a]);t=Math.max(t,r)}return t}function stackToString(e){for(var t="",n=0;n<e.length;++n)t&&(t+="\n"),t+=e[n].tag.label;return t}function ExprContext(e,t,n,r,a,i){void 0!==e&&(this.initialize(e,t,n,r,a,i),this._functions=[])}function StringValue(e){this.value=e,this.type="string"}function BooleanValue(e){this.value=e,this.type="boolean"}function NumberValue(e){this.value=e,this.type="number"}function NodeSetValue(e){this.value=e,this.type="node-set"}function TokenExpr(e){this.value=e}function LocationExpr(){this.absolute=!1,this.steps=[]}function xPathStep(e,t,n,r,a){for(var i=t[n],o=a.clone(r),s=i.evaluate(o).nodeSetValue(),l=0;l<s.length;++l)n==t.length-1?e.push(s[l]):xPathStep(e,t,n+1,s[l],a)}function StepExpr(e,t,n){this.axis=e,this.nodetest=t,this.predicate=n||[]}function NodeTestAny(){this.value=new BooleanValue(!0)}function NodeTestElementOrAttribute(){}function NodeTestText(){}function NodeTestComment(){}function NodeTestPI(e){this.target=e}function NodeTestNC(e){this.regex=new RegExp("^"+e+":"),this.nsprefix=e}function NodeTestName(e){this.name=e,this.re=new RegExp("^"+e+"$","i")}function PredicateExpr(e){this.expr=e}function FunctionCallExpr(e){this.name=e,this.args=[]}function UnionExpr(e,t){this.expr1=e,this.expr2=t}function PathExpr(e,t){this.filter=e,this.rel=t}function FilterExpr(e,t){this.expr=e,this.predicate=t}function UnaryMinusExpr(e){this.expr=e}function BinaryExpr(e,t,n){this.expr1=e,this.expr2=n,this.op=t}function LiteralExpr(e){this.value=e}function NumberExpr(e){this.value=e}function VariableExpr(e){this.name=e}function makeTokenExpr(e){return new TokenExpr(e)}function passExpr(e){return e}function makeLocationExpr1(e,t){return t.absolute=!0,t}function makeLocationExpr2(e,t){return t.absolute=!0,t.prependStep(makeAbbrevStep(e.value)),t}function makeLocationExpr3(){var e=new LocationExpr;return e.appendStep(makeAbbrevStep(".")),e.absolute=!0,e}function makeLocationExpr4(e){var t=new LocationExpr;return t.absolute=!0,t.appendStep(makeAbbrevStep(e.value)),t}function makeLocationExpr5(e){var t=new LocationExpr;return t.appendStep(e),t}function makeLocationExpr6(e,t,n){return e.appendStep(n),e}function makeLocationExpr7(e,t,n){return e.appendStep(makeAbbrevStep(t.value)),e.appendStep(n),e}function makeStepExpr1(e){return makeAbbrevStep(e.value)}function makeStepExpr2(e){return makeAbbrevStep(e.value)}function makeStepExpr3(e,t,n){return new StepExpr(e.value,n)}function makeStepExpr4(e,t){return new StepExpr("attribute",t)}function makeStepExpr5(e){return new StepExpr("child",e)}function makeStepExpr6(e,t){return e.appendPredicate(t),e}function makeAbbrevStep(e){switch(e){case"//":return new StepExpr("descendant-or-self",new NodeTestAny);case".":return new StepExpr("self",new NodeTestAny);case"..":return new StepExpr("parent",new NodeTestAny)}}function makeNodeTestExpr1(){return new NodeTestElementOrAttribute}function makeNodeTestExpr2(e){return new NodeTestNC(e.value)}function makeNodeTestExpr3(e){return new NodeTestName(e.value)}function makeNodeTestExpr4(e){var t=e.value.replace(/\s*\($/,"");switch(t){case"node":return new NodeTestAny;case"text":return new NodeTestText;case"comment":return new NodeTestComment;case"processing-instruction":return new NodeTestPI("")}}function makeNodeTestExpr5(e,t){var n=e.replace(/\s*\($/,"");if("processing-instruction"!=n)throw n;return new NodeTestPI(t.value)}function makePredicateExpr(e,t){return new PredicateExpr(t)}function makePrimaryExpr(e,t){return t}function makeFunctionCallExpr1(e){return new FunctionCallExpr(e)}function makeFunctionCallExpr2(e,t,n,r){var a=new FunctionCallExpr(e);a.appendArg(n);for(var i=0;i<r.length;++i)a.appendArg(r[i]);return a}function makeArgumentExpr(e,t){return t}function makeUnionExpr(e,t,n){return new UnionExpr(e,n)}function makePathExpr1(e,t,n){return new PathExpr(e,n)}function makePathExpr2(e,t,n){return n.prependStep(makeAbbrevStep(t.value)),new PathExpr(e,n)}function makeFilterExpr(e,t){return t.length>0?new FilterExpr(e,t):e}function makeUnaryMinusExpr(e,t){return new UnaryMinusExpr(t)}function makeBinaryExpr(e,t,n){return new BinaryExpr(e,t,n)}function makeLiteralExpr(e){var t=e.value.substring(1,e.value.length-1);return new LiteralExpr(t)}function makeNumberExpr(e){return new NumberExpr(e.value)}function makeVariableReference(e,t){return new VariableExpr(t.value)}function makeSimpleExpr(e){if("$"==e.charAt(0))return new VariableExpr(e.substr(1));if("@"==e.charAt(0)){var t=new NodeTestName(e.substr(1)),n=new StepExpr("attribute",t),r=new LocationExpr;return r.appendStep(n),r}if(e.match(/^[0-9]+$/))return new NumberExpr(e);var t=new NodeTestName(e),n=new StepExpr("child",t),r=new LocationExpr;return r.appendStep(n),r}function makeSimpleExpr2(e){for(var t=xmlUtil.stringSplit(e,"/"),n=new LocationExpr,r=0;r<t.length;++r){var a=new NodeTestName(t[r]),i=new StepExpr("child",a);n.appendStep(i)}return n}function xpathParseInit(){function e(e,t,n){e[t]||(e[t]=[]),e[t].push(n)}if(!xpathRules.length){xpathGrammarRules.sort(function(e,t){var n=e[1].length,r=t[1].length;return r>n?1:n>r?-1:0});for(var t=1,n=0;n<xpathNonTerminals.length;++n)xpathNonTerminals[n].key=t++;for(n=0;n<xpathTokenRules.length;++n)xpathTokenRules[n].key=t++;for(xpathLog("XPath parse INIT: "+t+" rules"),n=0;n<xpathGrammarRules.length;++n)for(var r=xpathGrammarRules[n],a=r[1],i=a.length-1;i>=0;--i){if(a[i]==Q_1M){e(xpathRules,a[i-1].key,r);break}if(a[i]!=Q_MM&&a[i]!=Q_01){e(xpathRules,a[i].key,r);break}e(xpathRules,a[i-1].key,r),--i}xpathLog("XPath parse INIT: "+xpathRules.length+" rule bins");var o=0;xmlUtil.mapExec(xpathRules,function(e){e&&(o+=e.length)}),xpathLog("XPath parse INIT: "+o/xpathRules.length+" average bin size")}}function xpathCollectDescendants(e,t,n){if(n&&t.getElementsByTagName)return void copyArray(e,t.getElementsByTagName(n));for(var r=t.firstChild;r;r=r.nextSibling)e.push(r),xpathCollectDescendants(e,r)}function xpathExtractTagNameFromNodeTest(e){return e instanceof NodeTestName?e.name:e instanceof NodeTestAny||e instanceof NodeTestElementOrAttribute?"*":void 0}function xpathCollectDescendantsReverse(e,t){for(var n=t.lastChild;n;n=n.previousSibling)e.push(n),xpathCollectDescendantsReverse(e,n)}function xpathDomEval(e,t){var n=xpathParse(e),r=n.evaluate(new ExprContext(t));return r}function xpathSort(e,t){if(0!=t.length){for(var n=[],r=0;r<e.contextSize();++r){for(var a=e.nodelist[r],i={node:a,key:[]},o=e.clone(a,0,[a]),s=0;s<t.length;++s){var l,u=t[s],p=u.expr.evaluate(o);"text"==u.type?l=p.stringValue():"number"==u.type&&(l=p.numberValue()),i.key.push({value:l,order:u.order})}i.key.push({value:r,order:"ascending"}),n.push(i)}n.sort(xpathSortByKey);for(var h=[],r=0;r<n.length;++r)h.push(n[r].node);e.nodelist=h,e.setNode(0)}}function xpathSortByKey(e,t){for(var n=0;n<e.key.length;++n){var r="descending"==e.key[n].order?-1:1;if(e.key[n].value>t.key[n].value)return 1*r;if(e.key[n].value<t.key[n].value)return-1*r}return 0}function xpathEval(e,t,n){var r=e;void 0!==n&&t.node&&(r=t.node.prepare(e,n));var a=xpathParse(r),i=a.evaluate(t);return i}function xmlResolveEntities(e){for(var t=xmlUtil.stringSplit(e,"&"),n=t[0],r=1;r<t.length;++r){var a=t[r].indexOf(";");if(-1!=a){var i,o=t[r].substring(0,a),s=t[r].substring(a+1);switch(o){case"lt":i="<";break;case"gt":i=">";break;case"amp":i="&";break;case"quot":i='"';break;case"apos":i="'";break;case"nbsp":i=String.fromCharCode(160);break;default:var l=window.document.createElement("span");l.innerHTML="&"+o+"; ",i=l.childNodes[0].nodeValue.charAt(0)}n+=i+s}else n+=t[r]}return n}function xmlParse(e){var t=/\/$/,n=xmlCommon.XML10_TAGNAME_REGEXP,r=xmlCommon.XML10_ATTRIBUTE_REGEXP;e.match(/^<\?xml/)?5==e.search(new RegExp(xmlCommon.XML10_VERSION_INFO))?(n=xmlCommon.XML10_TAGNAME_REGEXP,r=xmlCommon.XML10_ATTRIBUTE_REGEXP):5==e.search(new RegExp(xmlCommon.XML11_VERSION_INFO))?(n=xmlCommon.XML11_TAGNAME_REGEXP,r=xmlCommon.XML11_ATTRIBUTE_REGEXP):(n=xmlCommon.XML10_TAGNAME_REGEXP,r=xmlCommon.XML10_ATTRIBUTE_REGEXP):(n=xmlCommon.XML10_TAGNAME_REGEXP,r=xmlCommon.XML10_ATTRIBUTE_REGEXP);var a=new XDocument,i=a,o=[],s=i;o.push(s);for(var l="",u=xmlUtil.stringSplit(e,"<"),p=1;p<u.length;++p){var h=xmlUtil.stringSplit(u[p],">"),c=h[0],E=xmlResolveEntities(h[1]||"");if(l){var m=u[p].indexOf(l);if(-1!=m){var d=u[p].substring(0,m);s.nodeValue+="<"+d,o.pop(),s=o[o.length-1],E=u[p].substring(m+l.length),l=""}else s.nodeValue+="<"+u[p],E=null}else if(0==c.indexOf("![CDATA[")){var x="![CDATA[".length,m=u[p].indexOf("]]>");if(-1!=m){var d=u[p].substring(x,m),f=a.createCDATASection(d);s.appendChild(f)}else{var d=u[p].substring(x);E=null;var f=a.createCDATASection(d);s.appendChild(f),s=f,o.push(f),l="]]>"}}else if(0==c.indexOf("!--")){var x="!--".length,m=u[p].indexOf("-->");if(-1!=m){var d=u[p].substring(x,m),f=a.createComment(d);s.appendChild(f)}else{var d=u[p].substring(x);E=null;var f=a.createComment(d);s.appendChild(f),s=f,o.push(f),l="-->"}}else if("/"==c.charAt(0))o.pop(),s=o[o.length-1];else if("?"==c.charAt(0));else if("!"==c.charAt(0));else{for(var N,T=c.match(t),g=n.exec(c)[1],f=a.createElement(g);N=r.exec(c);){var _=xmlResolveEntities(N[5]||N[7]||"");f.setAttribute(N[1],_)}s.appendChild(f),T||(s=f,o.push(f))}E&&s!=i&&s.appendChild(a.createTextNode(E))}return i}function domTraverseElements(e,t,n){var r;if(t&&(r=t.call(null,e),"boolean"==typeof r&&!r))return!1;for(var a=e.firstChild;a;a=a.nextSibling)if(a.nodeType==xmlCommon.DOM_ELEMENT_NODE&&(r=arguments.callee.call(this,a,t,n),"boolean"==typeof r&&!r))return!1;return n&&(r=n.call(null,e),"boolean"==typeof r&&!r)?!1:void 0}function XNode(e,t,n,r){this.attributes=[],this.childNodes=[],XNode.init.call(this,e,t,n,r),Object.defineProperty(this,"nodeTypedValue",{get:function(){return XSerializer.unescape(this)},set:function(e){var t=this.ownerDocument.createTextNode(e).innerText();if(2==this.nodeType)this.nodeValue=t;else{if(1!=this.nodeType)throw new Error("Node typed value cannot be set for this type of node.");this.innerText(t)}},enumerable:!1,configurable:!1})}function XDocument(){XNode.call(this,xmlCommon.DOM_DOCUMENT_NODE,"#document",null,null),this.documentElement=null}function XConverter(){}function XSerializer(){}function XNamespace(e,t){this.prefix=e,this.uri=t}XmlCommon.prototype.escapeText=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},XmlCommon.prototype.escapeAttr=function(e){return this.xmlEscapeText(e).replace(/\"/g,"&quot;")},XmlCommon.prototype.escapeTags=function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")};var xmlCommon=new XmlCommon;Set.prototype.size=function(){return this.keys.length},Set.prototype.add=function(e,t){var n=t||1;this.contains(e)||(this[":"+e]=n,this.keys.push(e))},Set.prototype.set=function(e,t){var n=t||1;this.contains(e)?this[":"+e]=n:(this[":"+e]=n,this.keys.push(e))},Set.prototype.inc=function(e){this.contains(e)?this[":"+e]++:(this[":"+e]=1,this.keys.push(e))},Set.prototype.get=function(e){return this.contains(e)?this[":"+e]:null},Set.prototype.remove=function(e){this.contains(e)&&(delete this[":"+e],removeFromArray(this.keys,e,!0))},Set.prototype.contains=function(e){return"undefined"!=typeof this[":"+e]},Set.prototype.items=function(){for(var e=[],t=0;t<this.keys.length;++t){var n=this.keys[t],r=this[":"+n];e.push(r)}return e},Set.prototype.map=function(e){for(var t=0;t<this.keys.length;++t){var n=this.keys[t];e.call(this,n,this[":"+n])}},Set.prototype.clear=function(){for(var e=0;e<this.keys.length;++e)delete this[":"+this.keys[e]];this.keys.length=0},XmlUtil.prototype.stringSplit=function(e,t){var n=e.indexOf(t);if(-1==n)return[e];var r=[];for(r.push(e.substr(0,n));-1!=n;){var a=e.indexOf(t,n+1);r.push(-1!=a?e.substr(n+1,a-n-1):e.substr(n+1)),n=a}return r},XmlUtil.prototype.mapExec=function(e,t){for(var n=0;n<e.length;++n)t.call(this,e[n],n)},XmlUtil.prototype.mapExpr=function(e,t){for(var n=[],r=0;r<e.length;++r)n.push(t(e[r]));return n},XmlUtil.prototype.xmlText=function(e,t){var n=[];return this.xmlTextR(e,n,t),n.join("")},XmlUtil.prototype.xmlTextR=function(e,t,n){if(e.nodeType==xmlCommon.DOM_TEXT_NODE)t.push(this.xmlEscapeText(e.nodeValue));else if(e.nodeType==xmlCommon.DOM_CDATA_SECTION_NODE)t.push(n?e.nodeValue:"<![CDATA["+e.nodeValue+"]]>");else if(e.nodeType==xmlCommon.DOM_COMMENT_NODE)t.push("<!--"+e.nodeValue+"-->");else if(e.nodeType==xmlCommon.DOM_ELEMENT_NODE){t.push("<"+this.xmlFullNodeName(e));for(var r=0;r<e.attributes.length;++r){var a=e.attributes[r];a&&a.nodeName&&a.nodeValue&&t.push(" "+this.xmlFullNodeName(a)+'="'+this.xmlEscapeAttr(a.nodeValue)+'"')}if(0==e.childNodes.length)t.push("/>");else{t.push(">");for(var r=0;r<e.childNodes.length;++r)arguments.callee(e.childNodes[r],t,n);t.push("</"+this.xmlFullNodeName(e)+">")}}else if(e.nodeType==xmlCommon.DOM_DOCUMENT_NODE||e.nodeType==xmlCommon.DOM_DOCUMENT_FRAGMENT_NODE)for(var r=0;r<e.childNodes.length;++r)arguments.callee(e.childNodes[r],t,n)},XmlUtil.prototype.xmlFullNodeName=function(e){return e.prefix&&0!=e.nodeName.indexOf(e.prefix+":")?e.prefix+":"+e.nodeName:e.nodeName},XmlUtil.prototype.isArray=function(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"===objectToString(e)},XmlUtil.prototype.format=function(e){if("string"!=typeof e){for(var t=[],n=0;n<arguments.length;n++)t.push(inspect(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,a=r.length,i=String(e).replace(formatRegExp,function(e){if("%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":return JSON.stringify(r[n++]);default:return e}}),o=r[n];a>n;o=r[++n])i+=null===o||"object"!=typeof o?" "+o:" "+inspect(o);return i},XmlUtil.prototype._extend=function(e,t){if(!t||"object"!=typeof t)return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e},XmlUtil.prototype.xmlEscapeText=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},XmlUtil.prototype.xmlEscapeAttr=function(e){return this.xmlEscapeText(e).replace(/\"/g,"&quot;")},XmlUtil.prototype.xmlEscapeTags=function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")};var xmlUtil=new XmlUtil,REGEXP_UNICODE=function(){for(var e=[" ","Ġ",-1,"!","Ġ",-1,"Ġ","Ġ",0,"ġ","Ġ",-1,"ġ","Ġ|ġ",0,"Ģ","Ġ|ġ",-1,"Ġ","[Ġ]",0,"ġ","[Ġ]",-1,"ġ","[Ġġ]",0,"Ģ","[Ġġ]",-1,"ġ","[Ġ-ġ]",0,"Ģ","[Ġ-ġ]",-1],t=0;t<e.length;t+=3)if(e[t].search(new RegExp(e[t+1]))!=e[t+2])return!1;return!0}(),XML_S="[ 	\r\n]+",XML_EQ="("+XML_S+")?=("+XML_S+")?",XML_CHAR_REF="&#[0-9]+;|&#x[0-9a-fA-F]+;",XML10_VERSION_INFO=XML_S+"version"+XML_EQ+"(\"1\\.0\"|'1\\.0')",XML10_BASE_CHAR=REGEXP_UNICODE?"A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣":"A-Za-z",XML10_IDEOGRAPHIC=REGEXP_UNICODE?"一-龥〇〡-〩":"",XML10_COMBINING_CHAR=REGEXP_UNICODE?"̀-͠ͅ-҃͡-֑҆-֣֡-ֹֻ-ֽֿׁ-ׂًׄ-ْٰۖ-ۜ۝-۟۠-ۤۧ-۪ۨ-ۭँ-ः़ा-ौ्॑-॔ॢ-ॣঁ-ঃ়ািী-ৄে-ৈো-্ৗৢ-ৣਂ਼ਾਿੀ-ੂੇ-ੈੋ-੍ੰ-ੱઁ-ઃ઼ા-ૅે-ૉો-્ଁ-ଃ଼ା-ୃେ-ୈୋ-୍ୖ-ୗஂ-ஃா-ூெ-ைொ-்ௗఁ-ఃా-ౄె-ైొ-్ౕ-ౖಂ-ಃಾ-ೄೆ-ೈೊ-್ೕ-ೖം-ഃാ-ൃെ-ൈൊ-്ൗัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-༹༙༵༷༾༿ཱ-྄྆-ྋྐ-ྕྗྙ-ྭྱ-ྷྐྵ⃐-〪⃜⃡-゙゚〯":"",XML10_DIGIT=REGEXP_UNICODE?"0-9٠-٩۰-۹०-९০-৯੦-੯૦-૯୦-୯௧-௯౦-౯೦-೯൦-൯๐-๙໐-໙༠-༩":"0-9",XML10_EXTENDER=REGEXP_UNICODE?"·ːˑ·ـๆໆ々〱-〵ゝ-ゞー-ヾ":"",XML10_LETTER=XML10_BASE_CHAR+XML10_IDEOGRAPHIC,XML10_NAME_CHAR=XML10_LETTER+XML10_DIGIT+"\\._:"+XML10_COMBINING_CHAR+XML10_EXTENDER+"-",XML10_NAME="["+XML10_LETTER+"_:]["+XML10_NAME_CHAR+"]*",XML10_ENTITY_REF="&"+XML10_NAME+";",XML10_REFERENCE=XML10_ENTITY_REF+"|"+XML_CHAR_REF,XML10_ATT_VALUE='"(([^<&"]|'+XML10_REFERENCE+")*)\"|'(([^<&']|"+XML10_REFERENCE+")*)'",XML10_ATTRIBUTE="("+XML10_NAME+")"+XML_EQ+"("+XML10_ATT_VALUE+")",XML11_VERSION_INFO=XML_S+"version"+XML_EQ+"(\"1\\.1\"|'1\\.1')",XML11_NAME_START_CHAR=REGEXP_UNICODE?":A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�":":A-Z_a-z",XML11_NAME_CHAR=XML11_NAME_START_CHAR+(REGEXP_UNICODE?"\\.0-9·̀-ͯ‿-⁀-":"\\.0-9-"),XML11_NAME="["+XML11_NAME_START_CHAR+"]["+XML11_NAME_CHAR+"]*",XML11_ENTITY_REF="&"+XML11_NAME+";",XML11_REFERENCE=XML11_ENTITY_REF+"|"+XML_CHAR_REF,XML11_ATT_VALUE='"(([^<&"]|'+XML11_REFERENCE+")*)\"|'(([^<&']|"+XML11_REFERENCE+")*)'",XML11_ATTRIBUTE="("+XML11_NAME+")"+XML_EQ+"("+XML11_ATT_VALUE+")",XML_NC_NAME_CHAR=XML10_LETTER+XML10_DIGIT+"\\._"+XML10_COMBINING_CHAR+XML10_EXTENDER+"-",XML_NC_NAME="["+XML10_LETTER+"_]["+XML_NC_NAME_CHAR+"]*",xpathParseCache={};ExprContext.prototype.initialize=function(e,t,n,r,a,i){this.node=e,this.position=t||0,this.nodelist=n||[e],this.variables={},this.parent=r||null,this.caseInsensitive=a||!1,this.ignoreAttributesWithoutValue=i||!1,this.root=r?r.root:this.node.nodeType==xmlCommon.DOM_DOCUMENT_NODE?e:e.ownerDocument},ExprContext.prototype.resolveFunction=function(e){this.invokeFunction=e},ExprContext.prototype.setFunctionContext=function(e,t){var n=null;if(("undefined"==typeof this._functions||null==this._functions)&&(this._functions=[]),this._functions.length>0)for(var r=0;r<this._functions.length;r++)if(this._functions[r].prefix==e){n=this._functions[r];break}null==n?this._functions.push({prefix:e,instance:t}):n.instance=t},ExprContext.prototype.getFunctionContext=function(e){if("undefined"==typeof this._functions||null==this._functions)return null;if(!xmlUtil.isArray(this._functions))return null;for(var t=null,n=0;n<this._functions.length;n++)if(this._functions[n].prefix==e){t=this._functions[n];break}return null==t?null:t.instance},ExprContext.prototype.clone=function(e,t,n){return new ExprContext(e||this.node,"undefined"!=typeof t?t:this.position,n||this.nodelist,this,this.caseInsensitive,this.ignoreAttributesWithoutValue)},ExprContext.prototype.setVariable=function(e,t){return t instanceof StringValue||t instanceof BooleanValue||t instanceof NumberValue||t instanceof NodeSetValue?void(this.variables[e]=t):void(this.variables[e]="true"===t?new BooleanValue(!0):"false"===t?new BooleanValue(!1):TOK_NUMBER.re.test(t)?new NumberValue(t):new StringValue(t))},ExprContext.prototype.getVariable=function(e){return"undefined"!=typeof this.variables[e]?this.variables[e]:this.parent?this.parent.getVariable(e):null},ExprContext.prototype.setNode=function(e){this.node=this.nodelist[e],this.position=e},ExprContext.prototype.contextSize=function(){return this.nodelist.length},ExprContext.prototype.isCaseInsensitive=function(){return this.caseInsensitive},ExprContext.prototype.setCaseInsensitive=function(e){return this.caseInsensitive=e},ExprContext.prototype.isIgnoreAttributesWithoutValue=function(){return this.ignoreAttributesWithoutValue},ExprContext.prototype.setIgnoreAttributesWithoutValue=function(e){return this.ignoreAttributesWithoutValue=e},ExprContext.prototype.evaluate=function(e,t){return void 0!==t?xpathEval(e,this,t):xpathEval(e,this)},StringValue.prototype.stringValue=function(){return this.value},StringValue.prototype.booleanValue=function(){return this.value.length>0},StringValue.prototype.numberValue=function(){return this.value-0},StringValue.prototype.nodeSetValue=function(){throw this},BooleanValue.prototype.stringValue=function(){return""+this.value},BooleanValue.prototype.booleanValue=function(){return this.value},BooleanValue.prototype.numberValue=function(){return this.value?1:0},BooleanValue.prototype.nodeSetValue=function(){throw this},NumberValue.prototype.stringValue=function(){return""+this.value},NumberValue.prototype.booleanValue=function(){return!!this.value},NumberValue.prototype.numberValue=function(){return this.value-0},NumberValue.prototype.nodeSetValue=function(){throw this},NodeSetValue.prototype.stringValue=function(){if(0==this.value.length)return"";if(1==this.value[0].nodeType||9==this.value[0].nodeType){for(var e="",t=0;t<this.value[0].childNodes.length;t++){var n=this.value[0].childNodes[t];3==n.nodeType&&(e+=n.nodeValue)}return e.replace(/(^\s*|\s*$)/g,"")}return this.value[0].nodeValue},NodeSetValue.prototype.booleanValue=function(){return this.value.length>0},NodeSetValue.prototype.numberValue=function(){return this.stringValue()-0},NodeSetValue.prototype.nodeSetValue=function(){return this.value},TokenExpr.prototype.evaluate=function(){return new StringValue(this.value)},LocationExpr.prototype.appendStep=function(e){var t=this._combineSteps(this.steps[this.steps.length-1],e);t?this.steps[this.steps.length-1]=t:this.steps.push(e)},LocationExpr.prototype.prependStep=function(e){var t=this._combineSteps(e,this.steps[0]);t?this.steps[0]=t:this.steps.unshift(e)},LocationExpr.prototype._combineSteps=function(e,t){if(!e)return null;if(!t)return null;var n=e.predicates&&e.predicates.length>0;if(e.nodetest instanceof NodeTestAny&&!n)if(e.axis==xpathAxis.DESCENDANT_OR_SELF){if(t.axis==xpathAxis.CHILD)return t.axis=xpathAxis.DESCENDANT,t;if(t.axis==xpathAxis.SELF)return t.axis=xpathAxis.DESCENDANT_OR_SELF,t}else if(e.axis==xpathAxis.DESCENDANT&&t.axis==xpathAxis.SELF)return t.axis=xpathAxis.DESCENDANT,t;return null},LocationExpr.prototype.evaluate=function(e){var t;t=this.absolute?e.root:e.node;var n=[];return xPathStep(n,this.steps,0,t,e),new NodeSetValue(n)},StepExpr.prototype.appendPredicate=function(e){this.predicate.push(e)},StepExpr.prototype.evaluate=function(e){var t=e.node,n=[],r=!1;if(this.nodetest instanceof NodeTestAny&&(r=!0),this.axis==xpathAxis.ANCESTOR_OR_SELF){n.push(t);for(var a=t.parentNode;a;a=a.parentNode)n.push(a)}else if(this.axis==xpathAxis.ANCESTOR)for(var a=t.parentNode;a;a=a.parentNode)n.push(a);else if(this.axis==xpathAxis.ATTRIBUTE)e.ignoreAttributesWithoutValue?copyArrayIgnoringAttributesWithoutValue(n,t.attributes):copyArray(n,t.attributes);else if(this.axis==xpathAxis.CHILD)copyArray(n,t.childNodes);else if(this.axis==xpathAxis.DESCENDANT_OR_SELF){this.nodetest.evaluate(e).booleanValue()&&n.push(t);var i=xpathExtractTagNameFromNodeTest(this.nodetest);xpathCollectDescendants(n,t,i),i&&(r=!0)}else if(this.axis==xpathAxis.DESCENDANT){var i=xpathExtractTagNameFromNodeTest(this.nodetest);xpathCollectDescendants(n,t,i),i&&(r=!0)}else if(this.axis==xpathAxis.FOLLOWING)for(var a=t;a;a=a.parentNode)for(var o=a.nextSibling;o;o=o.nextSibling)n.push(o),xpathCollectDescendants(n,o);else if(this.axis==xpathAxis.FOLLOWING_SIBLING)for(var a=t.nextSibling;a;a=a.nextSibling)n.push(a);else if(this.axis==xpathAxis.NAMESPACE)alert("not implemented: axis namespace");else if(this.axis==xpathAxis.PARENT)t.parentNode&&n.push(t.parentNode);else if(this.axis==xpathAxis.PRECEDING)for(var a=t;a;a=a.parentNode)for(var o=a.previousSibling;o;o=o.previousSibling)n.push(o),xpathCollectDescendantsReverse(n,o);else if(this.axis==xpathAxis.PRECEDING_SIBLING)for(var a=t.previousSibling;a;a=a.previousSibling)n.push(a);else{if(this.axis!=xpathAxis.SELF)throw"ERROR -- NO SUCH AXIS: "+this.axis;n.push(t)}if(!r){var s=n;n=[];for(var l=0;l<s.length;++l){var a=s[l];this.nodetest.evaluate(e.clone(a,l,s)).booleanValue()&&n.push(a)}}for(var l=0;l<this.predicate.length;++l){var s=n;n=[];for(var u=0;u<s.length;++u){var a=s[u];this.predicate[l].evaluate(e.clone(a,u,s)).booleanValue()&&n.push(a)}}return new NodeSetValue(n)},NodeTestAny.prototype.evaluate=function(){return this.value},NodeTestElementOrAttribute.prototype.evaluate=function(e){return new BooleanValue(e.node.nodeType==xmlCommon.DOM_ELEMENT_NODE||e.node.nodeType==xmlCommon.DOM_ATTRIBUTE_NODE)},NodeTestText.prototype.evaluate=function(e){return new BooleanValue(e.node.nodeType==xmlCommon.DOM_TEXT_NODE)},NodeTestComment.prototype.evaluate=function(e){return new BooleanValue(e.node.nodeType==xmlCommon.DOM_COMMENT_NODE)},NodeTestPI.prototype.evaluate=function(e){return new BooleanValue(e.node.nodeType==xmlCommon.DOM_PROCESSING_INSTRUCTION_NODE&&(!this.target||e.node.nodeName==this.target))},NodeTestNC.prototype.evaluate=function(e){var t=e.node;return new BooleanValue(this.regex.match(t.nodeName))},NodeTestName.prototype.evaluate=function(e){var t=e.node;return new BooleanValue(e.caseInsensitive?t.nodeName.length!=this.name.length?!1:this.re.test(t.nodeName):t.nodeName==this.name)},PredicateExpr.prototype.evaluate=function(e){var t=this.expr.evaluate(e);return new BooleanValue("number"==t.type?e.position==t.numberValue()-1:t.booleanValue())},FunctionCallExpr.prototype.appendArg=function(e){this.args.push(e)},FunctionCallExpr.prototype.evaluate=function(e,t){var n=""+this.name.value,r=this.xpathfunctions[n];if(r){if(!t)return r.call(this,e);r.call(this,e,t)}else{var a="",i=n,o=n.indexOf(":");o>0&&(i=n.substr(o+1),a=n.substr(0,o));var s=e.getFunctionContext(a);if(s){var n=s[i];if("function"==typeof n){if("function"!=typeof t)return n.call(this,e,this.args);n.call(this,e,this.args,t)}}else if("function"==typeof e.invokeFunction){if(!t)return e.invokeFunction.call(this,e,i,this.args);
e.invokeFunction.call(this,e,i,this.args,t)}if(!t)return new BooleanValue(!1);t(null,new BooleanValue(!1))}},FunctionCallExpr.prototype.xpathfunctions={last:function(e){return assert(0==this.args.length),new NumberValue(e.contextSize())},position:function(e){return assert(0==this.args.length),new NumberValue(e.position+1)},count:function(e){assert(1==this.args.length);var t=this.args[0].evaluate(e);return new NumberValue(t.nodeSetValue().length)},id:function(e){assert(1==this.args.length);var t,n=this.args[0].evaluate(e),r=[];if("node-set"==n.type){t=[];for(var a=n.nodeSetValue(),i=0;i<a.length;++i)for(var o=a[i].value.split(/\s+/),s=0;s<o.length;++s)t.push(o[s])}else t=n.stringValue().split(/\s+/);for(var l=e.root,i=0;i<t.length;++i){var u=l.getElementById(t[i]);u&&r.push(u)}return new NodeSetValue(r)},"local-name":function(){alert("not implmented yet: XPath function local-name()")},"namespace-uri":function(){alert("not implmented yet: XPath function namespace-uri()")},name:function(e){assert(1==this.args.length||0==this.args.length);var t;return t=0==this.args.length?[e.node]:this.args[0].evaluate(e).nodeSetValue(),new StringValue(0==t.length?"":t[0].nodeName)},string:function(e){return assert(1==this.args.length||0==this.args.length),new StringValue(0==this.args.length?new NodeSetValue([e.node]).stringValue():this.args[0].evaluate(e).stringValue())},concat:function(e){for(var t="",n=0;n<this.args.length;++n)t+=this.args[n].evaluate(e).stringValue();return new StringValue(t)},"starts-with":function(e){assert(2==this.args.length);var t=this.args[0].evaluate(e).stringValue(),n=this.args[1].evaluate(e).stringValue();return new BooleanValue(0==t.indexOf(n))},contains:function(e){assert(2==this.args.length);var t=this.args[0].evaluate(e).stringValue(),n=this.args[1].evaluate(e).stringValue();return new BooleanValue(-1!=t.indexOf(n))},"substring-before":function(e){assert(2==this.args.length);var t,n=this.args[0].evaluate(e).stringValue(),r=this.args[1].evaluate(e).stringValue(),a=n.indexOf(r);return t=-1==a?"":n.substr(0,a),new StringValue(t)},"substring-after":function(e){assert(2==this.args.length);var t,n=this.args[0].evaluate(e).stringValue(),r=this.args[1].evaluate(e).stringValue(),a=n.indexOf(r);return t=-1==a?"":n.substr(a+r.length),new StringValue(t)},substring:function(e){assert(2==this.args.length||3==this.args.length);var t,n=this.args[0].evaluate(e).stringValue(),r=this.args[1].evaluate(e).numberValue();if(2==this.args.length){var a=Math.max(0,Math.round(r)-1);t=n.substr(a)}else{var i=this.args[2].evaluate(e).numberValue(),o=Math.round(r)-1,a=Math.max(0,o),s=Math.round(i)-Math.max(0,-o);t=n.substr(a,s)}return new StringValue(t)},"string-length":function(e){var t;return t=this.args.length>0?this.args[0].evaluate(e).stringValue():new NodeSetValue([e.node]).stringValue(),new NumberValue(t.length)},"normalize-space":function(e){var t;return t=this.args.length>0?this.args[0].evaluate(e).stringValue():new NodeSetValue([e.node]).stringValue(),t=t.replace(/^\s*/,"").replace(/\s*$/,"").replace(/\s+/g," "),new StringValue(t)},translate:function(e){assert(3==this.args.length);for(var t=this.args[0].evaluate(e).stringValue(),n=this.args[1].evaluate(e).stringValue(),r=this.args[2].evaluate(e).stringValue(),a=0;a<n.length;++a)t=t.replace(new RegExp(n.charAt(a),"g"),r.charAt(a));return new StringValue(t)},"boolean":function(e){return assert(1==this.args.length),new BooleanValue(this.args[0].evaluate(e).booleanValue())},not:function(e){assert(1==this.args.length);var t=!this.args[0].evaluate(e).booleanValue();return new BooleanValue(t)},"true":function(){return assert(0==this.args.length),new BooleanValue(!0)},"false":function(){return assert(0==this.args.length),new BooleanValue(!1)},lang:function(e){assert(1==this.args.length);for(var t,n=this.args[0].evaluate(e).stringValue(),r=e.node;r&&r!=r.parentNode&&!(t=r.getAttribute("xml:lang"));)r=r.parentNode;if(t){var a=new RegExp("^"+n+"$","i");return new BooleanValue(t.match(a)||t.replace(/_.*$/,"").match(a))}return new BooleanValue(!1)},number:function(e){return assert(1==this.args.length||0==this.args.length),new NumberValue(1==this.args.length?this.args[0].evaluate(e).numberValue():new NodeSetValue([e.node]).numberValue())},sum:function(e){assert(1==this.args.length);for(var t=this.args[0].evaluate(e).nodeSetValue(),n=0,r=0;r<t.length;++r)n+=t[r].value-0;return new NumberValue(n)},floor:function(e){assert(1==this.args.length);var t=this.args[0].evaluate(e).numberValue();return new NumberValue(Math.floor(t))},ceiling:function(e){assert(1==this.args.length);var t=this.args[0].evaluate(e).numberValue();return new NumberValue(Math.ceil(t))},round:function(e){assert(1==this.args.length);var t=this.args[0].evaluate(e).numberValue();return new NumberValue(Math.round(t))},"ext-join":function(e){assert(2==this.args.length);for(var t=this.args[0].evaluate(e).nodeSetValue(),n=this.args[1].evaluate(e).stringValue(),r="",a=0;a<t.length;++a)r&&(r+=n),r+=t[a].value;return new StringValue(r)},"ext-if":function(e){return assert(3==this.args.length),this.args[0].evaluate(e).booleanValue()?this.args[1].evaluate(e):this.args[2].evaluate(e)},"ext-cardinal":function(e){assert(this.args.length>=1);for(var t=this.args[0].evaluate(e).numberValue(),n=[],r=0;t>r;++r)n.push(e.node);return new NodeSetValue(n)}},UnionExpr.prototype.evaluate=function(e){for(var t=this.expr1.evaluate(e).nodeSetValue(),n=this.expr2.evaluate(e).nodeSetValue(),r=t.length,a=0;a<n.length;++a){for(var i=n[a],o=!1,s=0;r>s;++s)t[s]==i&&(o=!0,s=r);o||t.push(i)}return new NodeSetValue(t)},PathExpr.prototype.evaluate=function(e){var t=this.filter.evaluate(e);if("undefined"==typeof t.nodeSetValue)return new NodeSetValue([]);for(var n=t.nodeSetValue(),r=[],a=0;a<n.length;++a)for(var i=this.rel.evaluate(e.clone(n[a],a,n)).nodeSetValue(),o=0;o<i.length;++o)r.push(i[o]);return new NodeSetValue(r)},FilterExpr.prototype.evaluate=function(e){for(var t=this.expr.evaluate(e).nodeSetValue(),n=0;n<this.predicate.length;++n){var r=t;t=[];for(var a=0;a<r.length;++a){var i=r[a];this.predicate[n].evaluate(e.clone(i,a,r)).booleanValue()&&t.push(i)}}return new NodeSetValue(t)},UnaryMinusExpr.prototype.evaluate=function(e){return new NumberValue(-this.expr.evaluate(e).numberValue())},BinaryExpr.prototype.evaluate=function(e){var t;switch(this.op.value){case"or":t=new BooleanValue(this.expr1.evaluate(e).booleanValue()||this.expr2.evaluate(e).booleanValue());break;case"and":t=new BooleanValue(this.expr1.evaluate(e).booleanValue()&&this.expr2.evaluate(e).booleanValue());break;case"+":t=new NumberValue(this.expr1.evaluate(e).numberValue()+this.expr2.evaluate(e).numberValue());break;case"-":t=new NumberValue(this.expr1.evaluate(e).numberValue()-this.expr2.evaluate(e).numberValue());break;case"*":t=new NumberValue(this.expr1.evaluate(e).numberValue()*this.expr2.evaluate(e).numberValue());break;case"mob":t=new NumberValue(this.expr1.evaluate(e).numberValue()%this.expr2.evaluate(e).numberValue());break;case"div":t=new NumberValue(this.expr1.evaluate(e).numberValue()/this.expr2.evaluate(e).numberValue());break;case"=":t=this.compare(e,function(e,t){return e==t});break;case"!=":t=this.compare(e,function(e,t){return e!=t});break;case"<":t=this.compare(e,function(e,t){return t>e});break;case"<=":t=this.compare(e,function(e,t){return t>=e});break;case">":t=this.compare(e,function(e,t){return e>t});break;case">=":t=this.compare(e,function(e,t){return e>=t});break;default:alert("BinaryExpr.evaluate: "+this.op.value)}return t},BinaryExpr.prototype.compare=function(e,t){var n,r=this.expr1.evaluate(e),a=this.expr2.evaluate(e);if("node-set"==r.type&&"node-set"==a.type){var i=r.stringValue(),o=r.stringValue();n=t(i,o)?!0:!1}else if("node-set"==r.type||"node-set"==a.type)if("number"==r.type){var s=r.numberValue(),l=a.numberValue();n=t(s,l)?!0:!1}else if("number"==a.type){var l=r.numberValue(),s=a.numberValue();n=t(l,s)?!0:!1}else if("string"==r.type){var s=r.stringValue(),l=a.stringValue();n=t(s,l)?!0:!1}else if("string"==a.type){var l=r.stringValue(),s=a.stringValue();n=t(s,l)?!0:!1}else n=t(r.booleanValue(),a.booleanValue());else n="boolean"==r.type||"boolean"==a.type?t(r.booleanValue(),a.booleanValue()):"number"==r.type||"number"==a.type?t(r.numberValue(),a.numberValue()):t(r.stringValue(),a.stringValue());return new BooleanValue(n)},LiteralExpr.prototype.evaluate=function(){return new StringValue(this.value)},NumberExpr.prototype.evaluate=function(){return new NumberValue(this.value)},VariableExpr.prototype.evaluate=function(e){return e.getVariable(this.name)};var xpathAxis={ANCESTOR_OR_SELF:"ancestor-or-self",ANCESTOR:"ancestor",ATTRIBUTE:"attribute",CHILD:"child",DESCENDANT_OR_SELF:"descendant-or-self",DESCENDANT:"descendant",FOLLOWING_SIBLING:"following-sibling",FOLLOWING:"following",NAMESPACE:"namespace",PARENT:"parent",PRECEDING_SIBLING:"preceding-sibling",PRECEDING:"preceding",SELF:"self"},xpathAxesRe=[xpathAxis.ANCESTOR_OR_SELF,xpathAxis.ANCESTOR,xpathAxis.ATTRIBUTE,xpathAxis.CHILD,xpathAxis.DESCENDANT_OR_SELF,xpathAxis.DESCENDANT,xpathAxis.FOLLOWING_SIBLING,xpathAxis.FOLLOWING,xpathAxis.NAMESPACE,xpathAxis.PARENT,xpathAxis.PRECEDING_SIBLING,xpathAxis.PRECEDING,xpathAxis.SELF].join("|"),TOK_PIPE={label:"|",prec:17,re:new RegExp("^\\|")},TOK_DSLASH={label:"//",prec:19,re:new RegExp("^//")},TOK_SLASH={label:"/",prec:30,re:new RegExp("^/")},TOK_AXIS={label:"::",prec:20,re:new RegExp("^::")},TOK_COLON={label:":",prec:1e3,re:new RegExp("^:")},TOK_AXISNAME={label:"[axis]",re:new RegExp("^("+xpathAxesRe+")")},TOK_PARENO={label:"(",prec:34,re:new RegExp("^\\(")},TOK_PARENC={label:")",re:new RegExp("^\\)")},TOK_DDOT={label:"..",prec:34,re:new RegExp("^\\.\\.")},TOK_DOT={label:".",prec:34,re:new RegExp("^\\.")},TOK_AT={label:"@",prec:34,re:new RegExp("^@")},TOK_COMMA={label:",",re:new RegExp("^,")},TOK_OR={label:"or",prec:10,re:new RegExp("^or\\b")},TOK_AND={label:"and",prec:11,re:new RegExp("^and\\b")},TOK_EQ={label:"=",prec:12,re:new RegExp("^=")},TOK_NEQ={label:"!=",prec:12,re:new RegExp("^!=")},TOK_GE={label:">=",prec:13,re:new RegExp("^>=")},TOK_GT={label:">",prec:13,re:new RegExp("^>")},TOK_LE={label:"<=",prec:13,re:new RegExp("^<=")},TOK_LT={label:"<",prec:13,re:new RegExp("^<")},TOK_PLUS={label:"+",prec:14,re:new RegExp("^\\+"),left:!0},TOK_MINUS={label:"-",prec:14,re:new RegExp("^\\-"),left:!0},TOK_DIV={label:"div",prec:15,re:new RegExp("^div\\b"),left:!0},TOK_MOD={label:"mob",prec:15,re:new RegExp("^mob\\b"),left:!0},TOK_BRACKO={label:"[",prec:32,re:new RegExp("^\\[")},TOK_BRACKC={label:"]",re:new RegExp("^\\]")},TOK_DOLLAR={label:"$",re:new RegExp("^\\$")},TOK_NCNAME={label:"[ncname]",re:new RegExp("^"+xmlCommon.XML_NC_NAME)},TOK_ASTERISK={label:"*",prec:15,re:new RegExp("^\\*"),left:!0},TOK_LITERALQ={label:"[litq]",prec:20,re:new RegExp("^'[^\\']*'")},TOK_LITERALQQ={label:"[litqq]",prec:20,re:new RegExp('^"[^\\"]*"')},TOK_NUMBER={label:"[number]",prec:35,re:new RegExp("^\\d+(\\.\\d*)?")},TOK_QNAME={label:"[qname]",re:new RegExp("^("+xmlCommon.XML_NC_NAME+":)?"+xmlCommon.XML_NC_NAME)},TOK_NODEO={label:"[nodetest-start]",re:new RegExp("^(processing-instruction|comment|text|node)\\(")},xpathTokenRules=[TOK_DSLASH,TOK_SLASH,TOK_DDOT,TOK_DOT,TOK_AXIS,TOK_COLON,TOK_AXISNAME,TOK_NODEO,TOK_PARENO,TOK_PARENC,TOK_BRACKO,TOK_BRACKC,TOK_AT,TOK_COMMA,TOK_OR,TOK_AND,TOK_NEQ,TOK_EQ,TOK_GE,TOK_GT,TOK_LE,TOK_LT,TOK_PLUS,TOK_MINUS,TOK_ASTERISK,TOK_PIPE,TOK_MOD,TOK_DIV,TOK_LITERALQ,TOK_LITERALQQ,TOK_NUMBER,TOK_QNAME,TOK_NCNAME,TOK_DOLLAR],XPathLocationPath={label:"LocationPath"},XPathRelativeLocationPath={label:"RelativeLocationPath"},XPathAbsoluteLocationPath={label:"AbsoluteLocationPath"},XPathStep={label:"Step"},XPathNodeTest={label:"NodeTest"},XPathPredicate={label:"Predicate"},XPathLiteral={label:"Literal"},XPathExpr={label:"Expr"},XPathPrimaryExpr={label:"PrimaryExpr"},XPathVariableReference={label:"Variablereference"},XPathNumber={label:"Number"},XPathFunctionCall={label:"FunctionCall"},XPathArgumentRemainder={label:"ArgumentRemainder"},XPathPathExpr={label:"PathExpr"},XPathUnionExpr={label:"UnionExpr"},XPathFilterExpr={label:"FilterExpr"},XPathDigits={label:"Digits"},xpathNonTerminals=[XPathLocationPath,XPathRelativeLocationPath,XPathAbsoluteLocationPath,XPathStep,XPathNodeTest,XPathPredicate,XPathLiteral,XPathExpr,XPathPrimaryExpr,XPathVariableReference,XPathNumber,XPathFunctionCall,XPathArgumentRemainder,XPathPathExpr,XPathUnionExpr,XPathFilterExpr,XPathDigits],Q_01={label:"?"},Q_MM={label:"*"},Q_1M={label:"+"},ASSOC_LEFT=!0,xpathGrammarRules=[[XPathLocationPath,[XPathRelativeLocationPath],18,passExpr],[XPathLocationPath,[XPathAbsoluteLocationPath],18,passExpr],[XPathAbsoluteLocationPath,[TOK_SLASH,XPathRelativeLocationPath],18,makeLocationExpr1],[XPathAbsoluteLocationPath,[TOK_DSLASH,XPathRelativeLocationPath],18,makeLocationExpr2],[XPathAbsoluteLocationPath,[TOK_SLASH],0,makeLocationExpr3],[XPathAbsoluteLocationPath,[TOK_DSLASH],0,makeLocationExpr4],[XPathRelativeLocationPath,[XPathStep],31,makeLocationExpr5],[XPathRelativeLocationPath,[XPathRelativeLocationPath,TOK_SLASH,XPathStep],31,makeLocationExpr6],[XPathRelativeLocationPath,[XPathRelativeLocationPath,TOK_DSLASH,XPathStep],31,makeLocationExpr7],[XPathStep,[TOK_DOT],33,makeStepExpr1],[XPathStep,[TOK_DDOT],33,makeStepExpr2],[XPathStep,[TOK_AXISNAME,TOK_AXIS,XPathNodeTest],33,makeStepExpr3],[XPathStep,[TOK_AT,XPathNodeTest],33,makeStepExpr4],[XPathStep,[XPathNodeTest],33,makeStepExpr5],[XPathStep,[XPathStep,XPathPredicate],33,makeStepExpr6],[XPathNodeTest,[TOK_ASTERISK],33,makeNodeTestExpr1],[XPathNodeTest,[TOK_NCNAME,TOK_COLON,TOK_ASTERISK],33,makeNodeTestExpr2],[XPathNodeTest,[TOK_QNAME],33,makeNodeTestExpr3],[XPathNodeTest,[TOK_NODEO,TOK_PARENC],33,makeNodeTestExpr4],[XPathNodeTest,[TOK_NODEO,XPathLiteral,TOK_PARENC],33,makeNodeTestExpr5],[XPathPredicate,[TOK_BRACKO,XPathExpr,TOK_BRACKC],33,makePredicateExpr],[XPathPrimaryExpr,[XPathVariableReference],33,passExpr],[XPathPrimaryExpr,[TOK_PARENO,XPathExpr,TOK_PARENC],33,makePrimaryExpr],[XPathPrimaryExpr,[XPathLiteral],30,passExpr],[XPathPrimaryExpr,[XPathNumber],30,passExpr],[XPathPrimaryExpr,[XPathFunctionCall],31,passExpr],[XPathFunctionCall,[TOK_QNAME,TOK_PARENO,TOK_PARENC],-1,makeFunctionCallExpr1],[XPathFunctionCall,[TOK_QNAME,TOK_PARENO,XPathExpr,XPathArgumentRemainder,Q_MM,TOK_PARENC],-1,makeFunctionCallExpr2],[XPathArgumentRemainder,[TOK_COMMA,XPathExpr],-1,makeArgumentExpr],[XPathUnionExpr,[XPathPathExpr],20,passExpr],[XPathUnionExpr,[XPathUnionExpr,TOK_PIPE,XPathPathExpr],20,makeUnionExpr],[XPathPathExpr,[XPathLocationPath],20,passExpr],[XPathPathExpr,[XPathFilterExpr],19,passExpr],[XPathPathExpr,[XPathFilterExpr,TOK_SLASH,XPathRelativeLocationPath],19,makePathExpr1],[XPathPathExpr,[XPathFilterExpr,TOK_DSLASH,XPathRelativeLocationPath],19,makePathExpr2],[XPathFilterExpr,[XPathPrimaryExpr,XPathPredicate,Q_MM],31,makeFilterExpr],[XPathExpr,[XPathPrimaryExpr],16,passExpr],[XPathExpr,[XPathUnionExpr],16,passExpr],[XPathExpr,[TOK_MINUS,XPathExpr],-1,makeUnaryMinusExpr],[XPathExpr,[XPathExpr,TOK_OR,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_AND,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_EQ,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_NEQ,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_LT,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_LE,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_GT,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_GE,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_PLUS,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_MINUS,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_ASTERISK,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_DIV,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_MOD,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathLiteral,[TOK_LITERALQ],-1,makeLiteralExpr],[XPathLiteral,[TOK_LITERALQQ],-1,makeLiteralExpr],[XPathNumber,[TOK_NUMBER],-1,makeNumberExpr],[XPathVariableReference,[TOK_DOLLAR,TOK_QNAME],200,makeVariableReference]],xpathRules=[],xpath={evaluate:xpathEval,select:xpathDomEval,BinaryExpr:BinaryExpr,ExprContext:ExprContext,createContext:function(e){return new ExprContext(e)},BooleanValue:BooleanValue,FilterExpr:FilterExpr,LiteralExpr:LiteralExpr,LocationExpr:LocationExpr,NodeSetValue:NodeSetValue,NodeTestAny:NodeTestAny,NodeTestComment:NodeTestComment,NodeTestElementOrAttribute:NodeTestElementOrAttribute,NodeTestName:NodeTestName,NodeTestNC:NodeTestNC,NodeTestPI:NodeTestPI,NodeTestText:NodeTestText,NumberExpr:NumberExpr,NumberValue:NumberValue,PathExpr:PathExpr,PredicateExpr:PredicateExpr,StepExpr:StepExpr};if(XNode.prototype.appendChild=function(e){0==this.childNodes.length&&(this.firstChild=e),e.previousSibling=this.lastChild,e.nextSibling=null,this.lastChild&&(this.lastChild.nextSibling=e),e.parentNode=this,this.lastChild=e,this.childNodes.push(e)},XNode.prototype.replaceChild=function(e,t){if(t!=e)for(var n=0;n<this.childNodes.length;++n)if(this.childNodes[n]==t){this.childNodes[n]=e;var r=t.parentNode;t.parentNode=null,e.parentNode=r,r=t.previousSibling,t.previousSibling=null,e.previousSibling=r,e.previousSibling&&(e.previousSibling.nextSibling=e),r=t.nextSibling,t.nextSibling=null,e.nextSibling=r,e.nextSibling&&(e.nextSibling.previousSibling=e),this.firstChild==t&&(this.firstChild=e),this.lastChild==t&&(this.lastChild=e);break}},XNode.prototype.insertBefore=function(e,t){if(t!=e&&t.parentNode==this){e.parentNode&&e.parentNode.removeChild(e);for(var n=[],r=0;r<this.childNodes.length;++r){var a=this.childNodes[r];a==t&&(n.push(e),e.parentNode=this,e.previousSibling=t.previousSibling,t.previousSibling=e,e.previousSibling&&(e.previousSibling.nextSibling=e),e.nextSibling=t,this.firstChild==t&&(this.firstChild=e)),n.push(a)}this.childNodes=n}},XNode.prototype.prependChild=function(e){0==this.childNodes.length&&this.appendChild(e)},XNode.prototype.removeChild=function(e){for(var t=[],n=0;n<this.childNodes.length;++n){var r=this.childNodes[n];r!=e?t.push(r):(r.previousSibling&&(r.previousSibling.nextSibling=r.nextSibling),r.nextSibling&&(r.nextSibling.previousSibling=r.previousSibling),this.firstChild==r&&(this.firstChild=r.nextSibling),this.lastChild==r&&(this.lastChild=r.previousSibling))}this.childNodes=t},XNode.prototype.hasAttributes=function(){return null==this.attributes?!1:this.attributes.length>0},XNode.prototype.hasAttribute=function(e){return"string"!=typeof e?!1:null==this.attributes?!1:null!=this.selectSingleNode("@".concat(e))},XNode.prototype.setAttribute=function(e,t){for(var n=0;n<this.attributes.length;++n)if(this.attributes[n].nodeName==e)return void(this.attributes[n].nodeValue=""+t);this.attributes.push(XNode.create(xmlCommon.DOM_ATTRIBUTE_NODE,e,t,this))},XNode.prototype.getAttribute=function(e){for(var t=0;t<this.attributes.length;++t)if(this.attributes[t].nodeName==e)return this.attributes[t].nodeValue;return null},XNode.prototype.removeAttribute=function(e){for(var t=[],n=0;n<this.attributes.length;++n)this.attributes[n].nodeName!=e&&t.push(this.attributes[n]);this.attributes=t},XNode.prototype.getElementsByTagName=function(e){var t=[],n=this;return"*"==e?domTraverseElements(this,function(e){n!=e&&t.push(e)},null):domTraverseElements(this,function(r){n!=r&&r.nodeName==e&&t.push(r)},null),t},XNode.prototype.getElementById=function(e){var t=null;return domTraverseElements(this,function(n){return n.getAttribute("id")==e?(t=n,!1):void 0},null),t},XNode.prototype.value=function(){var e="";if(this.nodeType==xmlCommon.DOM_TEXT_NODE||this.nodeType==xmlCommon.DOM_CDATA_SECTION_NODE)e+=this.nodeValue;else if(this.nodeType==xmlCommon.DOM_ATTRIBUTE_NODE)e+=this.nodeValue;else if(this.nodeType==xmlCommon.DOM_ELEMENT_NODE||this.nodeType==xmlCommon.DOM_DOCUMENT_NODE||this.nodeType==xmlCommon.DOM_DOCUMENT_FRAGMENT_NODE)for(var t=0;t<this.childNodes.length;++t)e+=arguments.callee(this.childNodes[t]);return e},XNode.prototype.hasChildNodes=function(){return null==this.childNodes?!1:this.childNodes.length>0},XNode.prototype.innerText=function(e){if(void 0===e){if(this.nodeType==xmlCommon.DOM_TEXT_NODE||this.nodeType==xmlCommon.DOM_CDATA_SECTION_NODE||this.nodeType==xmlCommon.DOM_COMMENT_NODE||this.nodeType==xmlCommon.DOM_ATTRIBUTE_NODE)return this.nodeValue?this.nodeValue:"";var t="";if(this.hasChildNodes())for(var n=0;n<this.childNodes.length;n++)t+=this.childNodes[n].innerText();return t}if(this.nodeType==xmlCommon.DOM_TEXT_NODE||this.nodeType==xmlCommon.DOM_CDATA_SECTION_NODE||this.nodeType==xmlCommon.DOM_COMMENT_NODE||this.nodeType==xmlCommon.DOM_ATTRIBUTE_NODE||this.nodeType==xmlCommon.DOM_ELEMENT_NODE){for(;this.childNodes.length>0;)this.removeChild(this.childNodes[0]);var r=e?xmlCommon.escapeText(e):"",a=this.ownerDocument.createTextNode(r);return void this.appendChild(a)}throw"Invalid property set operation"},XNode.prototype.innerXML=function(){if(this.nodeType==xmlCommon.DOM_TEXT_NODE||this.nodeType==xmlCommon.DOM_CDATA_SECTION_NODE||this.nodeType==xmlCommon.DOM_COMMENT_NODE)return"";if(this.nodeType==xmlCommon.DOM_ATTRIBUTE_NODE)return this.nodeValue?this.nodeValue:"";if(this.hasChildNodes()){for(var e="",t=0;t<this.childNodes.length;t++)e+=this.childNodes[t].outerXML();return e}},XNode.prototype.outerXML=function(){var e="";switch(this.nodeType){case xmlCommon.DOM_ATTRIBUTE_NODE:return e+=this.name(),e+='="',e+=this.nodeValue?xmlCommon.escapeText(this.nodeValue):"",e+='"';case xmlCommon.DOM_DOCUMENT_NODE:return this.innerXML();case xmlCommon.DOM_TEXT_NODE:return this.nodeValue?xmlCommon.escapeText(this.nodeValue):"";case xmlCommon.DOM_CDATA_SECTION_NODE:return e+="<![CDATA[",e+=this.nodeValue?this.nodeValue:"",e+="]]>";case xmlCommon.DOM_COMMENT_NODE:return e+="<!--",e+=this.nodeValue?this.nodeValue:"",e+="-->"}if(e+="<"+this.name(),this.hasAttributes())for(var t=0;t<this.attributes.length;t++)e+=" "+this.attributes[t].outerXML();if(e+=">",this.hasChildNodes())for(var t=0;t<this.childNodes.length;t++)e+=this.childNodes[t].outerXML();return e+="</"+this.name()+">"},XNode.prototype.selectNodes=function(e,t){var n=(void 0===t?e:this.prepare(e,t),xpath.select(e,this));return n.value},XNode.prototype.selectSingleNode=function(e,t){var n=void 0===t?e:this.prepare(e,t),r=xpath.select("("+n+")[1]",this);return r.value.length>0?r.value[0]:null},XNode.prototype.createContext=function(){var e=new xpath.ExprContext(this);return e},XNode.prototype.prepare=function(e,t){if(void 0===t)return e;for(var n=e,r=0;r<t.length;r++){var a=t[r];if(a&&a.prefix&&a.uri&&n.indexOf(a.prefix)>=0){var i=null;if(i="#document"==this.nodeName?this.documentElement.lookupPrefix(a.uri):this.lookupPrefix(a.uri)){var o=new RegExp("\\b"+a.prefix+"\\b:","g");n=n.replace(o,i+":")}}}return n},XNode.prototype.removeAll=function(){for(;this.childNodes.length>0;)this.removeChild(this.childNodes[0]);for(;this.attributes.length>0;)this.attributes.pop()},XNode.prototype.name=function(){return this.prefix&&0!=this.nodeName.indexOf(this.prefix+":")?this.prefix+":"+this.nodeName:this.nodeName},XNode.prototype.lookupPrefix=function(e){var t=0;if(this.nodeName)for(;t<this.attributes.length;){if("xmlns"==this.attributes[t].prefix&&this.attributes[t].nodeValue==e)return this.attributes[t].localName;t++}return null!=this.parentNode?this.parentNode.lookupPrefix(e):void 0},XNode.init=function(e,t,n,r){this.nodeType=e-0,this.nodeName=""+t,this.prefix="",this.localName=this.nodeName;var a=this.nodeName.indexOf(":");a>0&&(this.localName=this.nodeName.substr(a+1),this.prefix=this.nodeName.substr(0,a)),this.nodeValue=""+n,this.ownerDocument=r,this.firstChild=null,this.lastChild=null,this.nextSibling=null,this.previousSibling=null,this.parentNode=null},XNode.unused_=[],XNode.recycle=function(e){if(e){if(e.constructor==XDocument)return void XNode.recycle(e.documentElement);if(e.constructor==this){XNode.unused_.push(e);for(var t=0;t<e.attributes.length;++t)XNode.recycle(e.attributes[t]);for(var n=0;n<e.childNodes.length;++n)XNode.recycle(e.childNodes[n]);e.attributes.length=0,e.childNodes.length=0,XNode.init.call(e,0,"","",null)}}},XNode.create=function(e,t,n,r){if(XNode.unused_.length>0){var a=XNode.unused_.pop();return XNode.init.call(a,e,t,n,r),a}return new XNode(e,t,n,r)},XDocument.prototype=new XNode(xmlCommon.DOM_DOCUMENT_NODE,"#document"),XDocument.prototype.clear=function(){XNode.recycle(this.documentElement),this.documentElement=null},XDocument.prototype.appendChild=function(e){XNode.prototype.appendChild.call(this,e),this.documentElement=this.childNodes[0]},XDocument.prototype.createElement=function(e){return XNode.create(xmlCommon.DOM_ELEMENT_NODE,e,null,this)},XDocument.prototype.createDocumentFragment=function(){return XNode.create(xmlCommon.DOM_DOCUMENT_FRAGMENT_NODE,"#document-fragment",null,this)},XDocument.prototype.createTextNode=function(e){return XNode.create(xmlCommon.DOM_TEXT_NODE,"#text",e,this)},XDocument.prototype.createAttribute=function(e){return XNode.create(xmlCommon.DOM_ATTRIBUTE_NODE,e,null,this)},XDocument.prototype.createComment=function(e){return XNode.create(xmlCommon.DOM_COMMENT_NODE,"#comment",e,this)},XDocument.prototype.createCDATASection=function(e){return XNode.create(xmlCommon.DOM_CDATA_SECTION_NODE,"#cdata-section",e,this)},XDocument.loadXML=function(e){return xmlParse(e)},XDocument.loadSync=function(e){try{var t=require("fs");return XDocument.loadXML(t.readFileSync(e,"utf8"))}catch(n){throw n}},XDocument.load=function(e,t){try{t=t||function(){};var n=require("fs");n.readFile(e,"utf8",function(e,n){if(e)t(e);else try{t(null,XDocument.loadXML(n))}catch(r){t(r)}})}catch(r){t(r)}},XDocument.prototype.importNode=function(e){var t=this;if(e.nodeType==xmlCommon.DOM_TEXT_NODE)return this.createTextNode(e.nodeValue);if(e.nodeType==xmlCommon.DOM_CDATA_SECTION_NODE)return this.createCDATASection(e.nodeValue);if(e.nodeType==xmlCommon.DOM_ELEMENT_NODE){for(var n=this.createElement(e.nodeName),r=0;r<e.attributes.length;++r){var a=e.attributes[r],i=a.nodeName,o=a.nodeValue;n.setAttribute(i,o)}for(var s=e.firstChild;s;s=s.nextSibling){var l=t.importNode(s);n.appendChild(l)}return n}return t.createComment(e.nodeName)},"undefined"==typeof Date.prototype.toXMLString){var toXMLString=function(){var e=new Date(this.getTime()-6e4*this.getTimezoneOffset()),t=Math.floor(Math.abs(this.getTimezoneOffset()/60)).toString(),n=Math.abs(this.getTimezoneOffset()%60).toString(),r=(this.getTimezoneOffset()<0?"+":"-").concat(1==t.length?"0"+t:t,":",1==n.length?"0"+n:n),a=e.toISOString();return a.indexOf(".")>0&&(a=a.substr(0,a.indexOf("."))),a.concat(r)};if(Object.defineProperty)try{Object.defineProperty(Date.prototype,"toXMLString",{value:toXMLString,configurable:!0,enumerable:!1,writable:!0})}catch(e){}Date.prototype.toXMLString||(Date.prototype.toXMLString=toXMLString)}if(Date.prototype.writeXml=function(e){if("undefined"!=typeof e&&null!=e)if(1==e.nodeType)e.appendChild(e.ownerDocument.createTextNode(this.toXMLString()));else{if(9!=e.nodeType)throw new Error("Parent node is of invalid type.");var t=e.createElement("Date");t.appendChild(e.createTextNode(this.toXMLString())),e.appendChild(t)}},"undefined"==typeof Date.prototype.writeXml){var dateWriteXml=function(e){if("undefined"!=typeof e&&null!=e){if(1!=e.nodeType)throw new Error("Parent node is of invalid type.");e.appendChild(e.ownerDocument.createTextNode(this.toXMLString()))}};if(Object.defineProperty)try{Object.defineProperty(Date.prototype,"writeXml",{value:dateWriteXml,configurable:!0,enumerable:!1,writable:!0})}catch(e){}Date.prototype.writeXml||(Date.prototype.writeXml=dateWriteXml)}if("undefined"==typeof Array.prototype.writeXml){var writeXml=function(e,t){if("undefined"!=typeof e&&null!=e){t=t||{item:"Item"};for(var n=0;n<this.length;n++){var r=this[n];if("undefined"!=typeof r&&null!=r){var a=t.item?t.item:XSerializer.getClassName(r);XSerializer.writeXmlElement(e,a,r,t)}}}};if(Object.defineProperty)try{Object.defineProperty(Array.prototype,"writeXml",{value:writeXml,configurable:!0,enumerable:!1,writable:!0})}catch(e){}Array.prototype.writeXml||(Array.prototype.writeXml=writeXml)}XConverter.toInteger=function(e){if(e&&/\d/.test(e)){var t=parseInt(e);if(t>=-2147483648&&2147483647>=t)return t}return 0},XConverter.toFloat=function(e){return e&&/\d/.test(e)?parseFloat(e):0},XConverter.toLong=function(e){return e&&/\d/.test(e)?parseInt(e):0},XConverter.DateTimeRegex=/^(\\d{4})-(\\d{1,2})-(\\d{1,2})T(\\d{1,22}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{7}))?)?$/g,XConverter.types={"boolean":{parse:function(e){return/true|TRUE/.test(e)?!0:/false|FALSE/.test(e)?!1:/\d/.test(e)?0!=parseInt(e):!1}},"byte":{parse:function(e){return e&&/\d/.test(e)&&(e=parseInt(e),e>=-128&&127>=e)?e:0}},date:{parse:function(e){if("undefined"==typeof e||null==e)return null;var t=e.match(XSerializer.DateTimeRegex);if(null!=t){var n=parseInt(t[1]),r=parseInt(t[2]),a=parseInt(t[3]);return new Date(n,r,a)}throw new Error("Datetime format is invalid")}},dateTime:{parse:function(e){if("undefined"==typeof e||null==e)return null;var t=e.match(XConverter.DateTimeRegex);if(null!=t){var n=parseInt(t[1]),r=parseInt(t[2]),a=parseInt(t[3]),i=parseInt(t[4]),o=parseInt(t[5]),s=t[6].length>0?parseInt(t[6]):0;return new Date(n,r,a,i,o,s)}throw new Error("Datetime format is invalid")}},decimal:{parse:XConverter.toFloat},"double":{parse:XConverter.toFloat},gYear:{parse:function(e){return e&&/^(18|20)\d{2}$/.test(e)&&parseInt(e)>0?parseInt(e):1899}},"float":{parse:XConverter.toFloat},"int":{parse:XConverter.toInteger},integer:{parse:XConverter.toInteger},"long":{parse:XConverter.toLong},negativeInteger:{parse:function(e){return e&&/\d/.test(e)&&parseInt(e)<0?parseInt(e):-1}},nonNegativeInteger:{parse:function(e){return e&&/\d/.test(e)&&parseInt(e)>=0?parseInt(e):0}},nonPositiveInteger:{parse:function(e){return e&&/\d/.test(e)&&parseInt(e)<=0?parseInt(e):0}},positiveInteger:{parse:function(e){return e&&/\d/.test(e)&&parseInt(e)>0?parseInt(e):1}},"short":{parse:function(e){return e&&/\d/.test(e)&&(e=parseInt(e),e>=-32768&&32767>=e)?e:0}},string:{parse:function(e){return"undefined"==typeof e||null==e?null:e.toString()}},unsignedByte:{parse:function(e){return e&&/\d/.test(e)&&(e=parseInt(e),e>=0&&255>=e)?e:0}},unsignedInt:{parse:function(e){return e&&/\d/.test(e)&&(e=parseInt(e),e>=0&&4294967295>=e)?e:0}},unsignedLong:{parse:function(e){return e&&/\d/.test(e)&&(e=parseInt(e),e>=0&&0x10000000000000000>=e)?e:0}},unsignedShort:{parse:function(e){return e&&/\d/.test(e)&&(e=parseInt(e),e>=0&&65535>=e)?e:0}}},XSerializer.SR_DEFAULT_ROOT="Object",XSerializer.serialize=function(e,t){if("undefined"==typeof e||null==e)return null;t=t||{},xmlUtil._extend(t,{serializeNull:!0});var n=new XDocument,r=t.root?t.root:XSerializer.getClassName(e);if(n.appendChild(n.createElement(r)),"function"==typeof e.writeXml)e.writeXml(n.documentElement,t);else for(var a in e)e.hasOwnProperty(a)&&(/^_/.test(a)||XSerializer.writeXmlElement(n.documentElement,a,e[a],t));return n.documentElement},XSerializer.writeXmlElement=function(e,t,n,r){if("string"==typeof t){r=r||{serializeNull:!0};var a=e.ownerDocument.createElement(t);if("undefined"==typeof n||null==n)return void(r.serializeNull&&e.appendChild(a));if("object"==typeof n)if("function"==typeof n.writeXml)n.writeXml(a);else for(var i in n)n.hasOwnProperty(i)&&(/^_/.test(i)||XSerializer.writeXmlElement(a,i,n[i],r));else a.appendChild(a.ownerDocument.createTextNode(n));e.appendChild(a)}},XSerializer.XmlSchema="http://www.w3.org/2001/XMLSchema",XSerializer.getClassName=function(e){var t=XSerializer.SR_DEFAULT_ROOT;return"undefined"==typeof e||null==e?t:(e.__proto__&&e.__proto__.constructor&&(t=e.__proto__.constructor.name||XSerializer.SR_DEFAULT_ROOT),t)},XSerializer.unescape=function(e){var t=null,n=null;if(1==e.nodeType){var r=e.lookupPrefix(XSerializer.XmlSchema),t=e.getAttribute(r?r.concat(":type"):"type");n=e.innerText()}else 2==e.nodeType&&(n=e.nodeValue);return t?XConverter.types[t]?XConverter.types[t].parse(n):XConverter.types.string.parse(n):/^\d*\.?\d*$/.test(n)?XConverter.types.float.parse(n):XConverter.types.string.parse(n)
},XSerializer.deserialize=function(e,t){var n={};if("function"==typeof t){var n=new t;if("function"==typeof n.readXml)return n.readXml(e),n}("Array"==e.nodeName||"array"==e.getAttribute("type"))&&(n=[]);for(var r=e.childNodes.filter(function(e){return 1==e.nodeType}),a=0;a<r.length;a++){var i=r[a],o=i.childNodes.filter(function(e){return 1==e.nodeType});if(0==o.length)if(n[i.nodeName])if(xmlUtil.isArray(n[i.nodeName]))n[i.nodeName].push(XSerializer.unescape(i));else{var s=n[i.nodeName];n[i.nodeName]=[s,XSerializer.unescape(i)]}else n[i.nodeName]=XSerializer.unescape(i);else if(xmlUtil.isArray(n))n.push(XSerializer.deserialize(i));else{var l=XSerializer.deserialize(i);if(n[i.nodeName])if(xmlUtil.isArray(n[i.nodeName]))n[i.nodeName].push(l);else{var s=n[i.nodeName];n[i.nodeName]=[s,l]}else n[i.nodeName]=l}}return n};var xml={XDocument:XDocument,XNode:XNode,XNamespace:XNamespace,createDocument:function(){return new XDocument},loadSync:XDocument.loadSync,load:XDocument.load,loadXML:XDocument.loadXML,serialize:function(e,t){return XSerializer.serialize(e,t)},deserialize:function(e){return XSerializer.deserialize(e)},evaluate:xpath.evaluate,createContext:function(e){return new xpath.ExprContext(e)},xpath:xpath};angular&&angular.extend(angular,{xml:{create:function(){return new XDocument},load:function(e,t){XDocument.load(e,t)},loadXML:function(e){return XDocument.loadXML(e)},serialize:function(e,t){return XSerializer.serialize(e,t)},deserialize:function(e){return XSerializer.deserialize(e)}}});
